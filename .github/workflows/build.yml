name: Native Build
on: [ push, pull_request ]

jobs:
  check:
    runs-on: windows-latest
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup JDK 11
        uses: actions/setup-java@v3
        with:
          distribution: 'adopt'
          java-version: '11'

      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v1.1
        with:
          msbuild-architecture: x64

      - name: Native Build
        working-directory: native
        run: >
          msbuild native.sln
          -t:rebuild
          -p:Configuration=Release
          -p:Platform=x86
          -p:AssemblyName=CQP
          -p:OutPath='build\native\'
          -p:AdditionalLibPaths='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
          -p:AdditionalLibPath='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
          -p:AdditionalIncludePaths='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
          -p:AdditionalIncludePath='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
          -p:AdditionalLibraryDirectories='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
          -p:AdditionalReferencePaths='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
          -p:AdditionalReferencePath='"$(JAVA_HOME)\include;$(JAVA_HOME)\include\win32;"'
